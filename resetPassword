<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yummy Password Reset Redirect</title>
</head>
<body>
<script>
  const url = new URL(window.location.href);

  // Supabase bazen query'de, bazen hash fragment'ta döner
  const query = new URLSearchParams(url.search);
  const hash = new URLSearchParams((url.hash || '').replace(/^#/, ''));

  const accessToken = query.get('access_token') || hash.get('access_token') || '';
  const refreshToken = query.get('refresh_token') || hash.get('refresh_token') || '';
  const type = query.get('type') || hash.get('type') || '';

  // Sadece recovery/reset için çalışsın
  if (type !== 'recovery') {
    document.body.innerText = 'Geçersiz veya desteklenmeyen bağlantı.';
  } else {
    const deep = `yummy://reset-password?access_token=${encodeURIComponent(accessToken)}&refresh_token=${encodeURIComponent(refreshToken)}&type=${encodeURIComponent(type)}`;

    const ANDROID_PLAY_STORE = 'https://play.google.com/store/apps/details?id=com.mycompany.yummy';
    const IOS_APP_STORE = 'https://apps.apple.com/app/idYOUR_APP_ID';
    const WEB_FALLBACK = 'https://ciarponec.github.io/yummy-redirect/reset-password.html';

    const ua = navigator.userAgent || '';
    const isAndroid = /Android/i.test(ua);
    const isiOS = /iPhone|iPad|iPod/i.test(ua);

    const fallback = isiOS ? IOS_APP_STORE : (isAndroid ? ANDROID_PLAY_STORE : WEB_FALLBACK);

    window.location.href = deep;

    const delay = isiOS ? 1800 : 1200;
    setTimeout(() => {
      window.location.href = fallback;
    }, delay);
  }
</script>
</body>
</html>
